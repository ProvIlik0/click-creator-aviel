<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Click Speed Challenge ‚ö°</title>
<meta name="description" content="10 —Å–µ–∫—É–Ω–¥ –∫–ª–∏–∫–æ–≤. –ß–µ—Å—Ç–Ω—ã–π –ø–æ–¥—Å—á—ë—Ç CPS –±–µ–∑ –ª–∏–º–∏—Ç–æ–≤.">

<style>
* { box-sizing: border-box; }

body {
    margin: 0;
    min-height: 100vh;
    font-family: 'Segoe UI', Arial, sans-serif;
    background: radial-gradient(circle at top, #1b2b4a, #060b1a);
    display: flex;
    align-items: center;
    justify-content: center;
    color: #fff;
}

#app {
    background: rgba(20, 30, 60, 0.9);
    border-radius: 22px;
    padding: 28px;
    width: 360px;
    text-align: center;
    box-shadow: 0 0 45px rgba(0,0,0,0.7);
}

h1 { margin: 0 0 10px; }

#mainButton {
    margin: 18px 0;
    height: 140px;
    border-radius: 18px;
    background: linear-gradient(135deg, #4da3ff, #7f5cff);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 26px;
    font-weight: bold;
    color: #000;
    cursor: pointer;
    user-select: none;
    transition: transform .1s, box-shadow .1s, opacity .2s;
}
#mainButton:active { transform: scale(.95); }

.pulse { animation: pulse 1s infinite; }
.shake { animation: shake .2s; }
.locked { pointer-events: none; opacity: .6; }

#countdown {
    font-size: 34px;
    height: 50px;
}

#timer {
    height: 10px;
    width: 100%;
    background: #111;
    border-radius: 10px;
    overflow: hidden;
    margin: 8px 0 12px;
}
#timerBar {
    height: 100%;
    width: 0%;
    background: linear-gradient(90deg, #6bff95, #4da3ff);
}

canvas {
    width: 100%;
    height: 70px;
    background: #0c1224;
    border-radius: 8px;
    margin-top: 8px;
}

#stats { font-size: 14px; color: #ccc; margin-top: 6px; }
#result { margin-top: 10px; font-size: 16px; }

#records {
    margin-top: 12px;
    text-align: left;
    font-size: 13px;
}
#records b { display: block; margin-bottom: 4px; }

.good { color: #6bff95; }

@keyframes pulse {
    0% { box-shadow: 0 0 0 rgba(255,255,255,.4); }
    50% { box-shadow: 0 0 30px rgba(255,255,255,.9); }
    100% { box-shadow: 0 0 0 rgba(255,255,255,.4); }
}
@keyframes shake {
    0%{transform:translateX(0)}
    25%{transform:translateX(-4px)}
    50%{transform:translateX(4px)}
    75%{transform:translateX(-4px)}
    100%{transform:translateX(0)}
}
</style>
</head>
<body>

<div id="app">
    <h1>Click Speed ‚ö°</h1>

    <div id="countdown"></div>

    <div id="mainButton" class="pulse">–ì–æ—Ç–æ–≤?</div>

    <div id="timer"><div id="timerBar"></div></div>

    <canvas id="graph" width="300" height="70"></canvas>

    <div id="result"></div>

    <div id="stats">
        CPS: <span id="cps">0</span> |
        –£—Ä–æ–≤–µ–Ω—å: <span id="level">‚Äî</span>
    </div>

    <div id="records">
        <b>üèÜ –õ—É—á—à–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (–ª–æ–∫–∞–ª—å–Ω–æ)</b>
        <div id="recordsList"></div>
    </div>
</div>

<script>
/* ================== CONFIG ================== */
const TEST_TIME = 10000;
const COOLDOWN = 3000;

/* ================== ELEMENTS ================== */
const btn = document.getElementById("mainButton");
const cdEl = document.getElementById("countdown");
const bar = document.getElementById("timerBar");
const cpsEl = document.getElementById("cps");
const levelEl = document.getElementById("level");
const resultEl = document.getElementById("result");
const graph = document.getElementById("graph");
const g = graph.getContext("2d");
const recordsEl = document.getElementById("recordsList");

/* ================== STATE ================== */
let state = "idle"; // idle ‚Üí countdown ‚Üí running ‚Üí cooldown ‚Üí result
let clicks = [];
let cpsHistory = [];
let startTime = 0;
let timerInterval = null;

/* ================== RECORDS ================== */
let records = JSON.parse(localStorage.getItem("cps_records") || "[]");
renderRecords();

/* ================== BUTTON ================== */
btn.addEventListener("click", () => {
    if (state === "idle") startCountdown();
    else if (state === "running") registerClick();
    else if (state === "result") reset();
});

/* ================== COUNTDOWN ================== */
function startCountdown() {
    state = "countdown";
    btn.classList.remove("pulse");
    btn.textContent = "–ñ–î–ò";
    clicks = [];
    cpsHistory = [];

    let c = 3;
    cdEl.textContent = c;

    const cd = setInterval(() => {
        c--;
        if (c > 0) cdEl.textContent = c;
        else {
            clearInterval(cd);
            cdEl.textContent = "–ü–û–ï–•–ê–õ!";
            startTest();
        }
    }, 1000);
}

/* ================== START TEST ================== */
function startTest() {
    state = "running";
    btn.textContent = "–ö–õ–ò–ö–ê–ô!";
    startTime = performance.now();
    bar.style.width = "0%";

    timerInterval = setInterval(() => {
        const elapsed = performance.now() - startTime;
        bar.style.width = Math.min(100, elapsed / TEST_TIME * 100) + "%";

        const cpsNow = clicks.length / Math.max(1, elapsed / 1000);
        cpsHistory.push(cpsNow);
        drawGraph();

        if (elapsed >= TEST_TIME) finishTest();
    }, 80);
}

/* ================== CLICK ================== */
function registerClick() {
    clicks.push(performance.now());
    btn.classList.add("shake");
    setTimeout(() => btn.classList.remove("shake"), 120);
}

/* ================== FINISH ================== */
function finishTest() {
    clearInterval(timerInterval);
    state = "cooldown";
    btn.classList.add("locked");
    btn.textContent = "–ü–û–î–û–ñ–î–ò";

    const cps = +(clicks.length / (TEST_TIME / 1000)).toFixed(2);
    cpsEl.textContent = cps;
    levelEl.textContent = getLevel(cps);

    records.push(cps);
    records = records.sort((a,b)=>b-a).slice(0,5);
    localStorage.setItem("cps_records", JSON.stringify(records));
    renderRecords();

    resultEl.textContent = "–†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω";
    resultEl.className = "good";

    let cd = COOLDOWN / 1000;
    cdEl.textContent = "–ú–æ–∂–Ω–æ —á–µ—Ä–µ–∑ " + cd;

    const cool = setInterval(() => {
        cd--;
        if (cd > 0) cdEl.textContent = "–ú–æ–∂–Ω–æ —á–µ—Ä–µ–∑ " + cd;
        else {
            clearInterval(cool);
            state = "result";
            btn.classList.remove("locked");
            btn.classList.add("pulse");
            btn.textContent = "–ï–©–Å –†–ê–ó?";
            cdEl.textContent = "";
        }
    }, 1000);
}

/* ================== RESET ================== */
function reset() {
    state = "idle";
    btn.textContent = "–ì–æ—Ç–æ–≤?";
    cpsEl.textContent = "0";
    levelEl.textContent = "‚Äî";
    resultEl.textContent = "";
    bar.style.width = "0%";
    g.clearRect(0,0,graph.width,graph.height);
}

/* ================== GRAPH ================== */
function drawGraph() {
    g.clearRect(0,0,graph.width,graph.height);
    g.strokeStyle = "#6bff95";
    g.beginPath();

    cpsHistory.forEach((v,i)=>{
        const x = i / cpsHistory.length * graph.width;
        const y = graph.height - Math.min(v * 3.5, graph.height);
        i ? g.lineTo(x,y) : g.moveTo(x,y);
    });
    g.stroke();
}

/* ================== LEVELS (NO LIMIT) ================== */
function getLevel(cps) {
    if (cps < 4) return "–ù–æ–≤–∏—á–æ–∫";
    if (cps < 6) return "–ò–≥—Ä–æ–∫";
    if (cps < 8) return "–ë—ã—Å—Ç—Ä—ã–π";
    if (cps < 10) return "–ü—Ä–æ";
    if (cps < 13) return "‚ö° –û—á–µ–Ω—å –±—ã—Å—Ç—Ä—ã–π";
    if (cps < 16) return "üî• –≠–ª–∏—Ç–∞";
    return "üëë –ù–µ—á–µ–ª–æ–≤–µ–∫";
}

/* ================== RECORDS UI ================== */
function renderRecords() {
    recordsEl.innerHTML = records
        .map((r,i)=>`${i+1}. ${r} CPS`)
        .join("<br>");
}
</script>

</body>
</html>
